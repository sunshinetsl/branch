<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		   http://www.springframework.org/schema/security
		   http://www.springframework.org/schema/security/spring-security.xsd">

	<!-- 支持方法注解 @Secured -->
	<global-method-security jsr250-annotations="enabled" secured-annotations="enabled" pre-post-annotations="enabled"></global-method-security>

	<!-- Spring-Security 的配置 -->
	<http auto-config="true" use-expressions="true" access-decision-manager-ref="/account/loginPage">
		<intercept-url pattern="/account/**" access="permitAll"/>
		<intercept-url pattern="/common/**" access="permitAll"/>
		<intercept-url pattern="/layout/**" access="permitAll"/>
		<intercept-url pattern="/plugins/**" access="permitAll"/>
		<!-- 需要权限控制的模块单独加 -->
		<intercept-url pattern="/**" access="hasRole('ROLE_USER')"/>
		<intercept-url pattern="/index.jsp" access="permitAll"/>
		<intercept-url pattern="/home/show" access="permitAll"/>
		<intercept-url pattern="/homePage" access="permitAll"/>
		
		<form-login login-page="/account/loginPage" authentication-failure-handler-ref="/account/login?error=true" default-target-url="/home/show" always-use-default-target="true"/>
		
		<logout invalidate-session="true" logout-success-url="/account/logout" logout-url="/home/show"/>
		
		<!-- "记住我"功能，采用持久化策略（将用户的登录信息存放在数据库表中） -->
		<remember-me data-source-ref="dataSource"/>
		<!-- 检测失效的sessionId,超时时定位到另外一个URL -->
		<session-management invalid-session-url="/account/logout"/>
	</http>

	<!-- 指定一个自定义的authentication-manager -->
	<authentication-manager>
		<authentication-provider user-service-ref="securityUserService">
			<password-encoder ref="passwordEncoder"></password-encoder>
		</authentication-provider>
	</authentication-manager>
	
	<!-- 对密码进行MD5编码 -->
	<beans:bean class="org.springframework.security.authentication.encoding.Md5PasswordEncoder" id="passwordEncoder"/>

	<!-- 通过 securityUserService,Spring会自动的用户的访问级别. 也可以理解成:以后我们和数据库操作就是通过securityUserService来进行关联. -->
	<beans:bean id="securityUserService" class="com.dragon.common.serurity.UserDetailsServiceImpl"/>
	
	<!-- 国际化 -->
	<beans:bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<beans:property name="basename" value="classpath:org/springframework/security/messages_zh_CN"></beans:property>
	</beans:bean>

	<!-- 事件监听:实现了 ApplicationListener监听接口，包括AuthenticationCredentialsNotFoundEvent 
		事件， AuthorizationFailureEvent事件，AuthorizedEvent事件， PublicInvocationEvent事件 -->
	<beans:bean class="org.springframework.security.authentication.event.LoggerListener"/>

</beans:beans>